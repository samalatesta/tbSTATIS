<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Tutorial for tbSTATIS • tbSTATIS</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial for tbSTATIS">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tbSTATIS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/tbSTATIS_vignette.html">Tutorial for tbSTATIS</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Tutorial for tbSTATIS</h1>
            
      

      <div class="d-none name"><code>tbSTATIS_vignette.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This tutorial introduces the tbSTATIS package and walks through an
example of using tbSTATIS to classify tuberculosis (TB) disease
severity.</p>
<p>First we install tbSTATIS with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"samalatesta/tbSTATIS"</span><span class="op">)</span></span></code></pre></div>
<p>If we want the results to match this tutorial, we first set the seed
to match:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>We then load the package by running:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://samalatesta.github.io/tbSTATIS/">tbSTATIS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<p>We often collect information from multiple data sources such as
symptoms, sputum culture, sputum smear microscopy, and chest radiography
during the process of diagnosing persons with TB. While this information
is used to inform TB diagnosis, it is also strongly correlated with TB
disease severity. Common approaches to categorizing TB severity include
using smear microscopy or cavitation on chest x-ray alone offering only
a binary view of the TB disease spectrum.</p>
<p>We developed the <strong>tuberculosis SeveriTy Assessment Tool for
Informed Stratification (TB-STATIS)</strong> as a data-driven approach
to classifying TB disease severity that integrates information from
multiple data sources at time of TB diagnosis to assign individuals to a
predicted disease severity class. TB-STATIS only requires
cross-sectional data as input and does not require knowing a clinical
outcome as part of the classification process.</p>
</div>
<div class="section level2">
<h2 id="tb-statis-terminology">TB-STATIS Terminology<a class="anchor" aria-label="anchor" href="#tb-statis-terminology"></a>
</h2>
<table class="table">
<colgroup>
<col width="36%">
<col width="64%">
</colgroup>
<thead><tr class="header">
<th align="center">Term</th>
<th align="center">Definition</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">Clinical Measure</td>
<td align="center">Information collected during TB diagnosis that is
associated with disease severity. ex: symptoms, chest-xray, etc</td>
</tr>
<tr class="even">
<td align="center">Clinical State</td>
<td align="center">Each clinical measure has a set of clinical states.
ex: The clinical measure cavitation can have two states “no cavities” or
“cavities present”. The minimum number of states per clinical measure is
2.</td>
</tr>
<tr class="odd">
<td align="center">Disease Sequence</td>
<td align="center">The estimated number of disease classes and the
clinical states belonging to each class.</td>
</tr>
<tr class="even">
<td align="center">Predicted Disease Severity Class</td>
<td align="center">Disease severity class assigned to each individual
after estimating the disease sequence.</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="analysis-workflow">Analysis Workflow<a class="anchor" aria-label="anchor" href="#analysis-workflow"></a>
</h2>
<p>We recommend the following workflow as a general guide for analyzing
data with tbSTATIS. Functions required are listed in parentheses:<br>
1. Visualize clinical measures (plot_states())<br>
2. Estimate model (fit_STATIS())<br>
3. Check likelihood ascent plot (plot_likes())<br>
4. Estimate model for m bootstrap resamples (bootstrap_seq())<br>
5. Visualize uncertainty by making positional variance diagram
(pvd())<br>
6. Obtain predicted disease class for each observation and plot
distribution (pred_class() and plot_class())</p>
</div>
<div class="section level2">
<h2 id="example-data-set">Example Data Set<a class="anchor" aria-label="anchor" href="#example-data-set"></a>
</h2>
<p>We provide a synthetic data set TBData in the tbSTATIS package. We
will use this data set to walk through an example of analyzing data with
tbSTATIS to classify TB disease severity.</p>
<div class="section level3">
<h3 id="description">Description<a class="anchor" aria-label="anchor" href="#description"></a>
</h3>
<p>In the table below, we provide a description of each variable
included in the data set.</p>
<table class="table">
<thead><tr class="header">
<th align="center">Variable</th>
<th align="center">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">Index</td>
<td align="center">Unique row identifier</td>
</tr>
<tr class="even">
<td align="center">class</td>
<td align="center">True disease class</td>
</tr>
<tr class="odd">
<td align="center">X1</td>
<td align="center">Indicator for state 1 in clinical measure 1</td>
</tr>
<tr class="even">
<td align="center">X2</td>
<td align="center">Indicator for state 1 in clinical measure 2</td>
</tr>
<tr class="odd">
<td align="center">X3</td>
<td align="center">Indicator for state 2 in clinical measure 2</td>
</tr>
<tr class="even">
<td align="center">X4</td>
<td align="center">Indicator for state 1 in clinical measure 3</td>
</tr>
<tr class="odd">
<td align="center">X5</td>
<td align="center">Indicator for state 2 in clinical measure 3</td>
</tr>
<tr class="even">
<td align="center">X6</td>
<td align="center">Indicator for state 1 in clinical measure 4</td>
</tr>
<tr class="odd">
<td align="center">C1</td>
<td align="center">Binary covariate</td>
</tr>
<tr class="even">
<td align="center">C2</td>
<td align="center">Continuous covariate</td>
</tr>
</tbody>
</table>
<p>The data set contains 250 rows where each row represents data
observed on a unique individual. There are 10 columns in the data set.
For each individual, we record the value for 6 clinical states
corresponding to 4 clinical measures, and we include 2 covariates. The
motivation for including covariates is we are often interested in
associations between different variables with disease severity. Each
covariate was simulated to be positively correlated with disease
class.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">TBData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">TBData</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    250 obs. of  10 variables:</span></span>
<span><span class="co">#&gt;  $ Index: int  1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">#&gt;  $ class: num  0 1 2 4 2 2 0 3 0 0 ...</span></span>
<span><span class="co">#&gt;  $ X1   : int  0 0 0 1 0 0 0 1 0 0 ...</span></span>
<span><span class="co">#&gt;  $ X2   : int  1 1 1 1 1 1 0 1 0 0 ...</span></span>
<span><span class="co">#&gt;  $ X3   : int  0 0 0 1 0 0 0 1 0 0 ...</span></span>
<span><span class="co">#&gt;  $ X4   : int  0 0 0 1 1 1 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ X5   : int  0 0 1 1 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ X6   : int  0 1 1 1 1 1 0 1 0 0 ...</span></span>
<span><span class="co">#&gt;  $ C1   : int  0 0 1 1 1 1 0 1 1 0 ...</span></span>
<span><span class="co">#&gt;  $ C2   : num  1.455 3.3 1.547 4.263 -0.278 ...</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="true-disease-sequence">True disease sequence<a class="anchor" aria-label="anchor" href="#true-disease-sequence"></a>
</h3>
<p>Here is the ground truth sequence of states that was used to generate
TBData. There are 4 disease classes. States X2, X6 belong to class
1:</p>
<table class="table">
<thead><tr class="header">
<th align="center">Clinical State</th>
<th align="center">Disease Class</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">X1</td>
<td align="center">3</td>
</tr>
<tr class="even">
<td align="center">X2</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">X3</td>
<td align="center">3</td>
</tr>
<tr class="even">
<td align="center">X4</td>
<td align="center">2</td>
</tr>
<tr class="odd">
<td align="center">X5</td>
<td align="center">4</td>
</tr>
<tr class="even">
<td align="center">X6</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="data-summary">Data Summary<a class="anchor" aria-label="anchor" href="#data-summary"></a>
</h3>
<p>Below we provide the first 6 rows of our example data set. The third
observation in this data set is in disease class 2. States X2, X5, and
X6 have occurred as indicated with the value 1, and states X1, X3, and
X5 have not occurred which is indicated by the value 0. We generated
this data set setting p to 0.9 so each individual’s data may not align
perfectly with their true disease class. For example, observation 3 and
5 are both in class 2. Given the ground truth sequence, we would expect
X2, X4, and X6 to all have the value 1. For observation 5 this is true,
but for observation 3, X4 is equal to 0 and instead X5 is equal to
1.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">TBData</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Index class X1 X2 X3 X4 X5 X6 C1     C2</span></span>
<span><span class="co">#&gt; 1     1     0  0  1  0  0  0  0  0  1.455</span></span>
<span><span class="co">#&gt; 2     2     1  0  1  0  0  0  1  0  3.300</span></span>
<span><span class="co">#&gt; 3     3     2  0  1  0  0  1  1  1  1.547</span></span>
<span><span class="co">#&gt; 4     4     4  1  1  1  1  1  1  1  4.263</span></span>
<span><span class="co">#&gt; 5     5     2  0  1  0  1  0  1  1 -0.278</span></span>
<span><span class="co">#&gt; 6     6     2  0  1  0  1  0  1  1  2.363</span></span></code></pre></div>
<p>Here is the distribution of disease class. We can summarize true
disease class because we are using a simulated data set. We simulated
disease class using a uniform distribution, so we expect all classes to
be approximately equally present in the data. Notice here we have a
disease class 0 whereas in our true disease sequence above we did not.
This is because class 0 is equivalent to an individual being in the
earliest state for each clinical measure.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">TBData</span><span class="op">$</span><span class="va">class</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     0     1     2     3     4 </span></span>
<span><span class="co">#&gt; 0.236 0.208 0.164 0.160 0.232</span></span></code></pre></div>
<p>Here are the distributions for each covariate.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/proportions.html" class="external-link">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">TBData</span><span class="op">$</span><span class="va">C1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     0     1 </span></span>
<span><span class="co">#&gt; 0.436 0.564</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/fivenum.html" class="external-link">fivenum</a></span><span class="op">(</span><span class="va">TBData</span><span class="op">$</span><span class="va">C2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -1.8160  0.7800  1.5345  2.4420  4.8320</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="example-analysis">Example analysis<a class="anchor" aria-label="anchor" href="#example-analysis"></a>
</h2>
<div class="section level3">
<h3 id="visualize-clinical-states">Visualize clinical states<a class="anchor" aria-label="anchor" href="#visualize-clinical-states"></a>
</h3>
<p>Prior to fitting the model, it is good practice to first visualize
the data we are using. We can plot our data using the plot_states
function. This function first calculates the frequency of each state
occurring and orders the states from most frequent to least frequent.
The ordered states are the expected disease sequence for the data set as
an accumulation of states within each clinical measure should correspond
to more severe disease classes. We then sort observations by the ordered
states. We then plot each observation to visualize how well the data
follow the expected disease sequence. The x-axis corresponds to
observations after sorting and the y-axis corresponds to clinical states
ordered by frequency. Blue indicates the state has occurred and white
indicates the state has not occurred. If our data aligns well with the
expected disease sequence, we expect the top left area of the plot to be
mostly white and the bottom right to be consistently blue.</p>
<p>We present the plot from running the plot_states function with
TBData. The y axis is ordered as X6, X2, X4, X1, X3, X5. This aligns
with our ground truth sequence where X2, and X6 are in class 1 followed
by X4 inc class 2, then X1 and X3 in class 3 and finally X5 in class 4.
We see our data align well with the ground truth sequence overall with
few states occurring in the upper left hand portion of the plot. This is
a result of us using a value of .9 for all clinical states when we
simulated our data set. If p was lower, we would expect to see more
variation.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_states.html">plot_states</a></span><span class="op">(</span><span class="va">TBData</span>, id.var<span class="op">=</span><span class="st">"Index"</span>, state.vars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1"</span>, <span class="st">"X2"</span>, <span class="st">"X3"</span>, <span class="st">"X4"</span>, <span class="st">"X5"</span>, <span class="st">"X6"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tbSTATIS_vignette_files/figure-html/plot%20states-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="estimate-model">Estimate model<a class="anchor" aria-label="anchor" href="#estimate-model"></a>
</h3>
<p>We fit TB-STATIS using the fit_STATIS function. Prior to running the
model, the data set should be formatted such that each clinical state
has a recorded value of 1 to indicate the clinical state has occurred or
0 otherwise. If there are any observations with missing data they are
excluded prior to model fitting. We require the user to also input a
data frame that provides the set of clinical states for each clinical
measure and the clinical state that corresponds to a column name in the
data set used to fit the model.We provide the information data frame for
TBData that we will use to fit the model as an example. We must also
specify a value of p for each state.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">measure_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>clinical_measure<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"measure1"</span>, <span class="st">"measure2"</span>, <span class="st">"measure2"</span>, <span class="st">"measure3"</span>, <span class="st">"measure3"</span>, <span class="st">"measure4"</span><span class="op">)</span>,clinical_state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, state_name<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1"</span>, <span class="st">"X2"</span>, <span class="st">"X3"</span>, <span class="st">"X4"</span>, <span class="st">"X5"</span>, <span class="st">"X6"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">measure_info</span><span class="op">)</span></span>
<span><span class="co">#&gt;   clinical_measure clinical_state state_name</span></span>
<span><span class="co">#&gt; 1         measure1              1         X1</span></span>
<span><span class="co">#&gt; 2         measure2              1         X2</span></span>
<span><span class="co">#&gt; 3         measure2              2         X3</span></span>
<span><span class="co">#&gt; 4         measure3              1         X4</span></span>
<span><span class="co">#&gt; 5         measure3              2         X5</span></span>
<span><span class="co">#&gt; 6         measure4              1         X6</span></span></code></pre></div>
<p>The fit_STATIS function returns a list. One object in the list called
ml_seq is a data frame with 4 columns. The ‘sub’ column in this data
frame is the maximum likelihood sequence. We present the maximum
likelihood sequence for TBData. We ran the model with only 3 start
points and 250 iterations but in practice the minimum number of start
points should be 10 with at least 2000 iterations. From this output, the
maximum likelihood sequence is ({X6, X2}, {X4}, {X1, X3},{X5}) which is
the same as our ground truth sequence.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model1</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit_STATIS.html">fit_STATIS</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">TBData</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span><span class="op">]</span>, p_vec<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.9</span>,<span class="fl">.9</span>,<span class="fl">.9</span>,<span class="fl">.9</span>,<span class="fl">.9</span>,<span class="fl">.9</span><span class="op">)</span>, clinical_info<span class="op">=</span><span class="va">measure_info</span>, nstart<span class="op">=</span><span class="fl">3</span>,initial_iter<span class="op">=</span> <span class="fl">250</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#print maximum likelihood estimate</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">ml_seq</span><span class="op">)</span></span>
<span><span class="co">#&gt;        bio event var_name pos order sub</span></span>
<span><span class="co">#&gt; 1 measure2     1       X2   2     1   1</span></span>
<span><span class="co">#&gt; 2 measure4     1       X6   6     2   1</span></span>
<span><span class="co">#&gt; 3 measure3     1       X4   4     3   2</span></span>
<span><span class="co">#&gt; 4 measure1     1       X1   1     4   3</span></span>
<span><span class="co">#&gt; 5 measure2     2       X3   3     5   3</span></span>
<span><span class="co">#&gt; 6 measure3     2       X5   5     6   4</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="likelihood-ascent">Likelihood ascent<a class="anchor" aria-label="anchor" href="#likelihood-ascent"></a>
</h3>
<p>After estimating the model, we assess model convergence by plotting
the likelihood ascent for each start point using the plot_likes
function. The log-likelihoods for all iterations can be accessed from
the saved model object. For example, we saved our model as model1 above
and we can call model1$loglikes which is a dataframe that contains all
log-likelihoods across all iterations and start points. We present the
likelihood ascent plot for estimating the model with TBData. All
initializations do not converge to the same log-likelihood because we
only used 250 iterations to shorten computational time for this
tutorial. When running TB-STATIS with real data, it is likely the model
will not converge until at least 2000 iterations. When fitting the model
we recommend checking convergence by plotting the likelihood ascent and
if convergence is very slow or does not occur then to increase the total
number of iterations and/or start points and rerun the model.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#first 6 rows of loglikes data frame</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">loglikes</span><span class="op">)</span></span>
<span><span class="co">#&gt;   start iter      like</span></span>
<span><span class="co">#&gt; 2     1    1 -998.7502</span></span>
<span><span class="co">#&gt; 3     1    2 -965.6635</span></span>
<span><span class="co">#&gt; 4     1    3 -924.7706</span></span>
<span><span class="co">#&gt; 5     1    4 -775.9737</span></span>
<span><span class="co">#&gt; 6     1    5 -775.9737</span></span>
<span><span class="co">#&gt; 7     1    6 -775.9737</span></span>
<span></span>
<span><span class="co">#plot log-likelihoods for all iterations and start points</span></span>
<span><span class="fu"><a href="../reference/plot_likes.html">plot_likes</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">loglikes</span><span class="op">)</span></span></code></pre></div>
<p><img src="tbSTATIS_vignette_files/figure-html/likelihood%20ascent-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="bootstrap-resamples">Bootstrap resamples<a class="anchor" aria-label="anchor" href="#bootstrap-resamples"></a>
</h3>
<p>After fitting the model, we recommend constructing a positional
variance diagram to visualize uncertainty in the maximum likelihood
sequence. We provide the function bootstrap_seq to refit the model on a
chosen number of resamples with replacement from the observed data. We
recommend using at least 100 resamples. This function requires the same
inputs as fit_STATIS with the additional argument z which is the total
number of bootstrap resamples. The function returns a data frame where
each row represents the sequence estimated for 1 resample from our
observed data. We ran bootstrap_seq with TBData and our estimated
sequence above. We present the first 6 rows of output. If our model fits
the data well, we expect a majority of the bootstrap sequences to be the
same as our maximum likelihood sequence. Like with fit_STATIS, in
practice a mininum of 2000 iterations and 10 starting sequences should
be used.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">boot_seqs</span> <span class="op">=</span> <span class="fu"><a href="../reference/bootstrap_seq.html">bootstrap_seq</a></span><span class="op">(</span>z<span class="op">=</span><span class="fl">10</span>,data<span class="op">=</span><span class="va">TBData</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span><span class="op">]</span>, p_vec<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.9</span>,<span class="fl">.9</span>,<span class="fl">.9</span>,<span class="fl">.9</span>,<span class="fl">.9</span>,<span class="fl">.9</span><span class="op">)</span>, clinical_info<span class="op">=</span><span class="va">measure_info</span>, nstart<span class="op">=</span><span class="fl">3</span>,initial_iter<span class="op">=</span> <span class="fl">250</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">boot_seqs</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="positional-variance-diagram">Positional variance diagram<a class="anchor" aria-label="anchor" href="#positional-variance-diagram"></a>
</h3>
<p>After obtaining bootstrap sequences, we plot them in a positional
variance diagram (PVD) to visualize the location and degree of
uncertainty for our maximum likelihood sequence using the function pvd.
The function requires a data frame of bootstrap sequences and the
maximum likelihood sequence as input. The function returns a heatmap
where the x-axis is disease class and the y axis is each clinical state
in order of the maximum likelihood sequence. Each square in the plot
represents the proportion of bootstrap sequences where each state occurs
at each disease class. Darker colors indicate a higher proportion/degree
of certainty. The disease class estimated for each state in the maximum
likelihood sequence is outlined in black. We expect the highest
proportion of bootstrap samples for each state to occur for the class
where the state occurs in the maximum likelihood sequence.</p>
<p>We provide the PVD for the bootstrap samples for TBData below. A
majority of our bootstrap sequences were equivalent to the maximum
likelihood sequence. It is important to note that the x axis for the pvd
ranges from 1 to 6 to account for the fact that some bootstrap sequences
may have a different number of disease classes than our maximum
likelihood estimate. The maximum number of classes is always equal to
the total number of clinical states; for our example data set this is
6.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pvd.html">pvd</a></span><span class="op">(</span>boot_seqs <span class="op">=</span> <span class="va">boot_seqs</span>, ml<span class="op">=</span><span class="va">model1</span><span class="op">$</span><span class="va">ml_seq</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="predicted-disease-class">Predicted disease class<a class="anchor" aria-label="anchor" href="#predicted-disease-class"></a>
</h3>
<p>Our primary goal with using TB-STATIS is to understand TB disease
severity is to obtain a predicted disease class for each individual in
our sample. We include the function pred_class which calculates the
disease class with greatest probability given an individual’s observed
data and the estimated maximum likelihood sequence. Additionally, we
include the function plot_class that generates a bar plot for the
distribution of predicted disease class. We present the plot for
predicted disease class for our example data set. We see the disease
class distribution is approximately uniform which is expected since we
used a uniform distribution to generate the true disease class. In
practice, if we are using data from TB clinics, we would expect to see a
left-skewed distribution where we disproportionately observe individuals
with more severe disease.</p>
<p>Predicted disease class can be analyzed as an outcome as researchers
are frequently interested in factors associated with increased disease
severity. Disease class can also be use in secondary analysis as a
predictor when modeling other outcomes of interest.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#save estimated sequence from model</span></span>
<span><span class="va">est_seq</span><span class="op">=</span><span class="va">model1</span><span class="op">$</span><span class="va">ml_seq</span></span>
<span></span>
<span><span class="co">#calculate predicted disease class</span></span>
<span><span class="va">classdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pred_class.html">pred_class</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">TBData</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span><span class="op">]</span>, <span class="va">est_seq</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.9</span>,<span class="fl">.9</span>,<span class="fl">.9</span>,<span class="fl">.9</span>,<span class="fl">.9</span>,<span class="fl">.9</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#print first rows of data frame that includes predicted disease class</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">classdf</span><span class="op">)</span></span>
<span><span class="co">#&gt;   X1 X2 X3 X4 X5 X6 pred_stage</span></span>
<span><span class="co">#&gt; 1  0  1  0  0  0  0          0</span></span>
<span><span class="co">#&gt; 2  0  1  0  0  0  1          1</span></span>
<span><span class="co">#&gt; 3  0  1  0  0  1  1          1</span></span>
<span><span class="co">#&gt; 4  1  1  1  1  1  1          4</span></span>
<span><span class="co">#&gt; 5  0  1  0  1  0  1          2</span></span>
<span><span class="co">#&gt; 6  0  1  0  1  0  1          2</span></span>
<span></span>
<span><span class="co">#plot predicted disease class</span></span>
<span><span class="fu"><a href="../reference/plot_class.html">plot_class</a></span><span class="op">(</span>pred_class<span class="op">=</span><span class="va">classdf</span><span class="op">$</span><span class="va">pred_stage</span><span class="op">)</span></span></code></pre></div>
<p><img src="tbSTATIS_vignette_files/figure-html/disease%20class-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>In this tutorial, we illustrated how to use the tbSTATIS package to
analyze data to classify TB severity using clinical measures observed at
time of TB diagnosis. With our example data set TBData, we demonstrated
how to do the following:</p>
<ul>
<li>Visualize clinical states<br>
</li>
<li>Estimate the disease sequence<br>
</li>
<li>Check the likelihood ascent plot for model convergence<br>
</li>
<li>Generate bootstrap resamples and plot the positional variance
diagram to visualize uncertainty<br>
</li>
<li>Calculate predicted disease class and plot the distribution</li>
</ul>
<p>We conclude with some considerations and best practices for
practitioners wanting to analyze data with tbSTATIS.</p>
<ul>
<li>The method we present was motivated by prior work in event-based
modeling that was largely used to understand the progression of
neurodegenerative diseases. When applying our method to TB data, we are
not concerned with drawing conclusions about disease progression. We are
using TB-STATIS to classify disease severity at time of diagnosis
only.</li>
<li>Fitting TB-STATIS requires collecting data that is strongly
correlated with disease severity. For TB disease, we include measures
that are well-established as predictors of treatment outcome and TB
sterilization (cavitation, smear status, etc) and that are often used
individually to stratify patients into categories that represent
advanced versus early disease.<br>
</li>
<li>Fitting TB-STATIS also requires the user to input a value for p for
each clinical state included in the model. With TB diagnostic measures
and chest x-ray data, we expect p to be close to 1. The user should
always run a sensitivity analysis where they decrease p from their
original model fit to assess the sensitivity of the maximum likelihood
sequence to p.<br>
</li>
<li>In theory we can include as many clinical measures and states as
possible when fitting TB-STATIS. The performance of the method decreases
with smaller sample sizes, a larger number of clinical states, and lower
values of p for each state. We should consider these factors when
choosing data to estimate the model. An additional challenge includes
non-convergence when estimating the maximum likelihood sequence. This
can potentially be mitigated by increasing the number of iterations
during estimation but comes at the cost of increased computation time.
The user should always check the likelihood ascent plot to determine if
convergence was reached with the chosen number of iterations.<br>
</li>
<li>Finally, it is always best to visualize the observed data before
fitting the model which also provides the user with an expected disease
sequence to compare to the maximum likelihood estimate. This is
especially helpful if we are using TB-STATIS as a hypothesis generating
tool and do not already have a strong understanding about disease
sequence or severity.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Samantha Malatesta.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
